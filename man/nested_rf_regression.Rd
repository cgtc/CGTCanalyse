% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nested_rf_regression.R
\name{nested_rf_regression}
\alias{nested_rf_regression}
\title{Nested Random Forest Regression with Cross-Validation}
\usage{
nested_rf_regression(
  data,
  target_variable,
  seed = 123,
  trees = 500,
  mtry_range = c(1, 10),
  min_n_range = c(2, 10),
  levels = 5,
  outer_folds = 5,
  outer_repeats = 1,
  inner_folds = 5,
  final_tune_folds = 5,
  metric = "rmse",
  strata = NULL,
  group = NULL
)
}
\arguments{
\item{data}{A data frame or tibble containing predictors and the target variable.}

\item{target_variable}{A string indicating the name of the target variable column.}

\item{seed}{An integer seed for reproducibility. Default is 123.}

\item{trees}{Number of trees to use in the random forest. Default is 500.}

\item{mtry_range}{A numeric vector of length 2 specifying the range for `mtry` hyperparameter. Default is `c(1, 10)`.}

\item{min_n_range}{A numeric vector of length 2 specifying the range for `min_n` hyperparameter. Default is `c(2, 10)`.}

\item{levels}{Number of levels in the regular tuning grid. Default is 5.}

\item{outer_folds}{Number of outer cross-validation folds. Default is 5.}

\item{inner_folds}{Number of inner cross-validation folds for nested tuning. Default is 5.}

\item{final_tune_folds}{Number of folds for tuning on the full dataset before final model fitting. Default is 5.}

\item{metric}{Metric to use for model evaluation and tuning. Default is `"rmse"`.}

\item{strata}{Optional column name (string) to use for stratified sampling in resampling. Default is `NULL`.}

\item{group}{Optional column name (string) to use for grouped resampling (e.g., for repeated measures). Default is `NULL`.}
}
\value{
A list with three elements:
\describe{
  \item{`outer_performance`}{A tibble containing RMSE and R-squared scores from outer folds.}
  \item{`final_model`}{A fitted random forest workflow on the full dataset using the best parameters.}
  \item{`feature_importances`}{A tibble of variable importances sorted in descending order.}
}
}
\description{
Performs nested cross-validated hyperparameter tuning and model evaluation for
random forest regression using `ranger` via the `tidymodels` framework.
}
\details{
This function implements nested resampling for unbiased model evaluation and then
fits a final model using the full dataset and optimal hyperparameters. It optionally
handles stratified or grouped sampling in both inner and outer CV, and can exclude
stratification variables from predictor space automatically when appropriate.

The function uses the `ranger` engine and assumes
numeric predictors and response. Non-numeric columns should be preprocessed or removed.
}
\examples{
\dontrun{
results <- nested_rf_regression(
  data = my_data,
  target_variable = "yield",
  strata = "yield_quartile",
  trees = 200,
  outer_folds = 5,
  inner_folds = 3,
  final_tune_folds = 5,
  metric = "rmse"
)
results$outer_performance
results$feature_importances
}

}
